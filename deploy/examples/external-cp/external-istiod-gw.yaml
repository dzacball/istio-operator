apiVersion: networking.istio.io/v1beta1
kind: Gateway
metadata:
  name: external-istiod-gw
  namespace: external-istiod
spec:
  selector:
    istio: ingressgateway
  servers:
    - port:
        number: 15443
        protocol: https
        name: https-XDS
      tls:
        mode: SIMPLE
        credentialName: external-opneshift-72287d3323ba21ca6bea483947a1068a-0002
      hosts:
      - external-opneshift-72287d3323ba21ca6bea483947a1068a-0002.eu-de.containers.appdomain.cloud
    - port:
        number: 443
        protocol: https
        name: https-WEBHOOK
      tls:
        mode: SIMPLE
        credentialName: external-opneshift-72287d3323ba21ca6bea483947a1068a-0002
      hosts:
      - external-opneshift-72287d3323ba21ca6bea483947a1068a-0002.eu-de.containers.appdomain.cloud
---
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
   name: external-istiod-vs
   namespace: external-istiod
spec:
    hosts:
    - external-opneshift-72287d3323ba21ca6bea483947a1068a-0002.eu-de.containers.appdomain.cloud
    gateways:
    - external-istiod-gw
    http:
    - match:
      - port: 15443
      route:
      - destination:
          host: istiod.external-istiod.svc.cluster.local
          port:
            number: 15010
    - match:
      - port: 443
      route:
      - destination:
          host: istiod.external-istiod.svc.cluster.local
          port:
            number: 443
---
apiVersion: networking.istio.io/v1alpha3
kind: DestinationRule
metadata:
  name: external-istiod-dr
  namespace: external-istiod
spec:
  host: istiod.external-istiod.svc.cluster.local
  trafficPolicy:
    portLevelSettings:
    - port:
        number: 15443
      tls:
        mode: SIMPLE
      connectionPool:
        http:
          h2UpgradePolicy: UPGRADE
    - port:
        number: 443
      tls:
        mode: SIMPLE